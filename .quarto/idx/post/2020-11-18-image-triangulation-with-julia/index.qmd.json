{"title":"Image Triangulation with Julia","markdown":{"yaml":{"title":"Image Triangulation with Julia","author":"Bas","date":"2020-11-18"},"headingText":"Summary of method","containsRefs":false,"markdown":"\n\nI have always been fascinated by computer generated art. Recently, I came across the paper [Stylized Image Triangulation](https://cgl.ethz.ch/Downloads/Publications/Papers/2018/Law18a/Law18a.pdf) by Kai Lawonn and Tobias Günther. In this paper, the authors perform image triangulation (approximating an image by tessellation with triangles) by coming up with an initial grid and performing gradient descent. They achieve beautiful triangulations that capture the original images very well. Their code is a combination of MatLab and C++, and is [available on github](https://github.com/tobguent/image-triangulation).\n  \nAs a fun exercise in Julia, I implemented part of their method in a Pluto notebook (like a Jupyter notebook but especially for Julia, see [here](https://github.com/fonsp/Pluto.jl)). My notebook is [available on Github](https://github.com/basjacobs93/image_triangulation).  \n\nIn the paper, the authors start with an initial grid of points that defines a triangulation. This grid can either be a _regular layout_, in which the points are spaced evenly across the width and height of an image, or it can be made via _importance sampling_, in which 'important' regions of the image are found and points are sampled, weighted by this importance. Every triangle gets a constant color, calculated as the mean of the colors of its interior points in the original image.\n\nAs an example, consider this image of a beautiful bird called a _Bearded reedling (Panurus biarmicus)_, taken from [this YouTube video](https://www.youtube.com/watch?v=i8YPjJSuse0).\n\n![Bearded Reedling](/post/2020-11-18-image-triangulation-with-julia/baardman_2.png)\n\nThe two types of initial triangulation are the regular layout (in this case with 50 triangles),\n\n![Bearded Reedling (Regular Layout)](/post/2020-11-18-image-triangulation-with-julia/baardman_2_regular_layout.png)\nand the triangulation based on importance sampling (in this case by sampling 50 points).\n![Bearded Reedling (Importance Sampling)](/post/2020-11-18-image-triangulation-with-julia/baardman_2_importance_sampling.png)\n\nStarting with such a triangulation, the triangles are improved iteratively by gradient descent. For every point, a small change in the horizontal and vertical direction is tried, and a gradient is calculated by calculating the errors of the point's adjacent triangles for each such configuration. The error of a triangle is defined as the mean of the differences of its interior points' colors, compared to the original image. This way, the initial triangulation gets better every step, but it may converge to a local optimum, depending on the initial triangulation.  \n\nOn top of gradient descent, every couple of steps, every triangle can be split into three by placing an additional point at its centroid. This way, large triangles that have a big error can be split up into smaller triangles with different colors and smaller errors. The triangles eligible for this splitting have to be large enough, should not be too narrow, and should have a large error. These thresholds, together with the number of steps, step size, and other parameters can be tweaked in the code, yielding different results.  \n\nAn example output is the below, in which the initial grid was a regular layout, and which resulted in an image of 700 triangles.\n![Bearded reedling after optimization (700 triangles)](/post/2020-11-18-image-triangulation-with-julia/baardman_2_700.png)\n\nFor a more mathematically thorough explanation, I refer to the original paper.  \n\n\n## More results\n\nAnother beautiful picture of the same species of bird is the following ([source](https://commons.wikimedia.org/wiki/File:Bartmeise(Cropped)_by_Wolfram_Riech.jpg) by _Kaeptn chemnitz, [CC BY 3.0](https://creativecommons.org/licenses/by/3.0), via Wikimedia Commons_).\n\n![Bearded reedling (source: wikimedia)](/post/2020-11-18-image-triangulation-with-julia/baardman.png)\n\nThe resulting triangulations are more abstract than the above, but I think they are beautiful. The results with 100, 500, 1000 and 2000 triangles are below.\n\n![Bearded reedling (100 triangles)](/post/2020-11-18-image-triangulation-with-julia/baardman_100.png)\n![Bearded reedling (500 triangles)](/post/2020-11-18-image-triangulation-with-julia/baardman_500.png)\n![Bearded reedling (1000 triangles)](/post/2020-11-18-image-triangulation-with-julia/baardman_imp_1000.png)\n![Bearded reedling (2000 triangles)](/post/2020-11-18-image-triangulation-with-julia/baardman_2000.png)\n\nTwo more examples of triangulations with 2000 triangles are below. They represent a bluethroat and a red-backed shrike.\n\n![Bluethroat (2000 triangles)](/post/2020-11-18-image-triangulation-with-julia/blauwborst_2000.png)\n![Red-backed shrike (2000 triangles)](/post/2020-11-18-image-triangulation-with-julia/klauwier_2000.png)\n\n## More results (June 2022)\n\nI have updated the code to make the drawing faster and to include more techniques from the paper (edge flips and node collapse).  \nBelow is the new code demonstrated on the Lee Morgan album cover _Lee-way_ after 50, 100, 120 and 250 steps.\n\n![Lee-way Blue Note album cover](/post/2020-11-18-image-triangulation-with-julia/leeway.jpg)\n![Lee-way Blue Note album cover (50 steps)](/post/2020-11-18-image-triangulation-with-julia/leeway_58.png)\n![Lee-way Blue Note album cover (100 steps)](/post/2020-11-18-image-triangulation-with-julia/leeway_96.png)\n![Lee-way Blue Note album cover (120 steps)](/post/2020-11-18-image-triangulation-with-julia/leeway_119.png)\n![Lee-way Blue Note album cover (250 steps)](/post/2020-11-18-image-triangulation-with-julia/leeway_249.png)\n\nAnd the same on Cannonball Adderley's album _Somethin' Else_.\n![Somethin' Else Blue Note album cover](/post/2020-11-18-image-triangulation-with-julia/somethinelse.jpg)\n![Somethin' Else Blue Note album cover (20 steps)](/post/2020-11-18-image-triangulation-with-julia/somethinelse_20.png)\n![Somethin' Else Blue Note album cover (40 steps)](/post/2020-11-18-image-triangulation-with-julia/somethinelse_40.png)\n![Somethin' Else Blue Note album cover (60 steps)](/post/2020-11-18-image-triangulation-with-julia/somethinelse_60.png)\n![Somethin' Else Blue Note album cover (80 steps)](/post/2020-11-18-image-triangulation-with-julia/somethinelse_80.png)\n![Somethin' Else Blue Note album cover (100 steps)](/post/2020-11-18-image-triangulation-with-julia/somethinelse_100.png)\n![Somethin' Else Blue Note album cover (120 steps)](/post/2020-11-18-image-triangulation-with-julia/somethinelse_120.png)\n![Somethin' Else Blue Note album cover (140 steps)](/post/2020-11-18-image-triangulation-with-julia/somethinelse_140.png)\n\n\n## Conclusion\n\nImplementing part of the methodology of the paper in Julia was fairly straightforward, even though my experience with the language is limited. However, the performance is not as good as I hoped it would be. Generating the above images took a couple of minutes upto half an hour each. This makes it hard to fiddle around with the parameters, since a lot of time is spent waiting for the results. The authors of the paper wrote parts of their code in C++ because of performance, and parallelized and optimized the code such that it was faster. Although Julia code can be fast, my naive implementation still requires lots of loops (over the triangles, points, pixels), so it makes sense for it to be slow. That said, even though my implementation is naive, a pretty triangulation is only a key-press away and can be generated in a couple of minutes.  \n\nAs stated, the notebook is available [on GitHub](https://github.com/basjacobs93/image_triangulation), so feel free to try it out!\n","srcMarkdownNoYaml":"\n\nI have always been fascinated by computer generated art. Recently, I came across the paper [Stylized Image Triangulation](https://cgl.ethz.ch/Downloads/Publications/Papers/2018/Law18a/Law18a.pdf) by Kai Lawonn and Tobias Günther. In this paper, the authors perform image triangulation (approximating an image by tessellation with triangles) by coming up with an initial grid and performing gradient descent. They achieve beautiful triangulations that capture the original images very well. Their code is a combination of MatLab and C++, and is [available on github](https://github.com/tobguent/image-triangulation).\n  \nAs a fun exercise in Julia, I implemented part of their method in a Pluto notebook (like a Jupyter notebook but especially for Julia, see [here](https://github.com/fonsp/Pluto.jl)). My notebook is [available on Github](https://github.com/basjacobs93/image_triangulation).  \n\n## Summary of method\nIn the paper, the authors start with an initial grid of points that defines a triangulation. This grid can either be a _regular layout_, in which the points are spaced evenly across the width and height of an image, or it can be made via _importance sampling_, in which 'important' regions of the image are found and points are sampled, weighted by this importance. Every triangle gets a constant color, calculated as the mean of the colors of its interior points in the original image.\n\nAs an example, consider this image of a beautiful bird called a _Bearded reedling (Panurus biarmicus)_, taken from [this YouTube video](https://www.youtube.com/watch?v=i8YPjJSuse0).\n\n![Bearded Reedling](/post/2020-11-18-image-triangulation-with-julia/baardman_2.png)\n\nThe two types of initial triangulation are the regular layout (in this case with 50 triangles),\n\n![Bearded Reedling (Regular Layout)](/post/2020-11-18-image-triangulation-with-julia/baardman_2_regular_layout.png)\nand the triangulation based on importance sampling (in this case by sampling 50 points).\n![Bearded Reedling (Importance Sampling)](/post/2020-11-18-image-triangulation-with-julia/baardman_2_importance_sampling.png)\n\nStarting with such a triangulation, the triangles are improved iteratively by gradient descent. For every point, a small change in the horizontal and vertical direction is tried, and a gradient is calculated by calculating the errors of the point's adjacent triangles for each such configuration. The error of a triangle is defined as the mean of the differences of its interior points' colors, compared to the original image. This way, the initial triangulation gets better every step, but it may converge to a local optimum, depending on the initial triangulation.  \n\nOn top of gradient descent, every couple of steps, every triangle can be split into three by placing an additional point at its centroid. This way, large triangles that have a big error can be split up into smaller triangles with different colors and smaller errors. The triangles eligible for this splitting have to be large enough, should not be too narrow, and should have a large error. These thresholds, together with the number of steps, step size, and other parameters can be tweaked in the code, yielding different results.  \n\nAn example output is the below, in which the initial grid was a regular layout, and which resulted in an image of 700 triangles.\n![Bearded reedling after optimization (700 triangles)](/post/2020-11-18-image-triangulation-with-julia/baardman_2_700.png)\n\nFor a more mathematically thorough explanation, I refer to the original paper.  \n\n\n## More results\n\nAnother beautiful picture of the same species of bird is the following ([source](https://commons.wikimedia.org/wiki/File:Bartmeise(Cropped)_by_Wolfram_Riech.jpg) by _Kaeptn chemnitz, [CC BY 3.0](https://creativecommons.org/licenses/by/3.0), via Wikimedia Commons_).\n\n![Bearded reedling (source: wikimedia)](/post/2020-11-18-image-triangulation-with-julia/baardman.png)\n\nThe resulting triangulations are more abstract than the above, but I think they are beautiful. The results with 100, 500, 1000 and 2000 triangles are below.\n\n![Bearded reedling (100 triangles)](/post/2020-11-18-image-triangulation-with-julia/baardman_100.png)\n![Bearded reedling (500 triangles)](/post/2020-11-18-image-triangulation-with-julia/baardman_500.png)\n![Bearded reedling (1000 triangles)](/post/2020-11-18-image-triangulation-with-julia/baardman_imp_1000.png)\n![Bearded reedling (2000 triangles)](/post/2020-11-18-image-triangulation-with-julia/baardman_2000.png)\n\nTwo more examples of triangulations with 2000 triangles are below. They represent a bluethroat and a red-backed shrike.\n\n![Bluethroat (2000 triangles)](/post/2020-11-18-image-triangulation-with-julia/blauwborst_2000.png)\n![Red-backed shrike (2000 triangles)](/post/2020-11-18-image-triangulation-with-julia/klauwier_2000.png)\n\n## More results (June 2022)\n\nI have updated the code to make the drawing faster and to include more techniques from the paper (edge flips and node collapse).  \nBelow is the new code demonstrated on the Lee Morgan album cover _Lee-way_ after 50, 100, 120 and 250 steps.\n\n![Lee-way Blue Note album cover](/post/2020-11-18-image-triangulation-with-julia/leeway.jpg)\n![Lee-way Blue Note album cover (50 steps)](/post/2020-11-18-image-triangulation-with-julia/leeway_58.png)\n![Lee-way Blue Note album cover (100 steps)](/post/2020-11-18-image-triangulation-with-julia/leeway_96.png)\n![Lee-way Blue Note album cover (120 steps)](/post/2020-11-18-image-triangulation-with-julia/leeway_119.png)\n![Lee-way Blue Note album cover (250 steps)](/post/2020-11-18-image-triangulation-with-julia/leeway_249.png)\n\nAnd the same on Cannonball Adderley's album _Somethin' Else_.\n![Somethin' Else Blue Note album cover](/post/2020-11-18-image-triangulation-with-julia/somethinelse.jpg)\n![Somethin' Else Blue Note album cover (20 steps)](/post/2020-11-18-image-triangulation-with-julia/somethinelse_20.png)\n![Somethin' Else Blue Note album cover (40 steps)](/post/2020-11-18-image-triangulation-with-julia/somethinelse_40.png)\n![Somethin' Else Blue Note album cover (60 steps)](/post/2020-11-18-image-triangulation-with-julia/somethinelse_60.png)\n![Somethin' Else Blue Note album cover (80 steps)](/post/2020-11-18-image-triangulation-with-julia/somethinelse_80.png)\n![Somethin' Else Blue Note album cover (100 steps)](/post/2020-11-18-image-triangulation-with-julia/somethinelse_100.png)\n![Somethin' Else Blue Note album cover (120 steps)](/post/2020-11-18-image-triangulation-with-julia/somethinelse_120.png)\n![Somethin' Else Blue Note album cover (140 steps)](/post/2020-11-18-image-triangulation-with-julia/somethinelse_140.png)\n\n\n## Conclusion\n\nImplementing part of the methodology of the paper in Julia was fairly straightforward, even though my experience with the language is limited. However, the performance is not as good as I hoped it would be. Generating the above images took a couple of minutes upto half an hour each. This makes it hard to fiddle around with the parameters, since a lot of time is spent waiting for the results. The authors of the paper wrote parts of their code in C++ because of performance, and parallelized and optimized the code such that it was faster. Although Julia code can be fast, my naive implementation still requires lots of loops (over the triangles, points, pixels), so it makes sense for it to be slow. That said, even though my implementation is naive, a pretty triangulation is only a key-press away and can be generated in a couple of minutes.  \n\nAs stated, the notebook is available [on GitHub](https://github.com/basjacobs93/image_triangulation), so feel free to try it out!\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"toc":true,"html-math-method":"katex","output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.33","theme":["cosmo","brand"],"title":"Image Triangulation with Julia","author":"Bas","date":"2020-11-18"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}